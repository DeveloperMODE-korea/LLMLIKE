import React, { useState } from 'react';
import { Character } from '../types/game';
import { Shield, Brain, Zap, Heart, Coins, Award, Package, Cpu, Activity, Target, Wrench, ThermometerSun, Star, Users, Scroll, TrendingUp, Crown, Sword } from 'lucide-react';
import { WorldManager } from '../data/worldSettings';
import { CharacterAvatarWithTooltip } from './CharacterAvatar';
import { SimpleItemIcon } from './ItemIcon';
import AdvancedSystemsDashboard from './AdvancedSystemsDashboard';

interface CharacterStatsProps {
  character: Character;
}

const CharacterStats: React.FC<CharacterStatsProps> = ({ character }) => {
  const [activeTab, setActiveTab] = useState<'overview' | 'stats' | 'inventory' | 'advanced'>('overview');
  
  // ÌòÑÏû¨ ÏÑ∏Í≥ÑÍ¥Ä Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
  const currentWorld = WorldManager.getCurrentWorld();
  const statNames = currentWorld.statNames;

  // Îä•Î†•ÏπòÎ≥Ñ ÏïÑÏù¥ÏΩò Îß§Ìïë - Îçî ÌÅ∞ ÏïÑÏù¥ÏΩòÍ≥º Ìñ•ÏÉÅÎêú ÏÉâÏÉÅ
  const getStatIcon = (statKey: string, size: string = 'w-5 h-5') => {
    // ÏÑ∏Í≥ÑÍ¥ÄÎ≥ÑÎ°ú Îã§Î•∏ ÏïÑÏù¥ÏΩò Ï≤òÎ¶¨
    if (currentWorld.id === 'dark_finance') {
      const darkFinanceIcons: { [key: string]: { icon: JSX.Element; color: string } } = {
        capital: { icon: <Coins className={`${size} mr-2`} />, color: 'text-green-400' },
        information: { icon: <Brain className={`${size} mr-2`} />, color: 'text-blue-400' },
        network: { icon: <Users className={`${size} mr-2`} />, color: 'text-purple-400' },
        technical: { icon: <Cpu className={`${size} mr-2`} />, color: 'text-cyan-400' },
        psychology: { icon: <Activity className={`${size} mr-2`} />, color: 'text-pink-400' },
        reputation: { icon: <Crown className={`${size} mr-2`} />, color: 'text-yellow-400' },
      };
      return darkFinanceIcons[statKey] || { icon: <Shield className={`${size} mr-2`} />, color: 'text-gray-400' };
    }

    const iconMap: { [key: string]: { icon: JSX.Element; color: string } } = {
      // ÌåêÌÉÄÏßÄ ÏÑ∏Í≥ÑÍ¥Ä Îä•Î†•Ïπò
      health: { icon: <Heart className={`${size} mr-2`} />, color: 'text-red-400' },
      mana: { icon: <Zap className={`${size} mr-2`} />, color: 'text-blue-400' },
      strength: { icon: <Sword className={`${size} mr-2`} />, color: 'text-red-500' },
      intelligence: { icon: <Brain className={`${size} mr-2`} />, color: 'text-blue-500' },
      dexterity: { icon: <Zap className={`${size} mr-2`} />, color: 'text-yellow-400' },
      constitution: { icon: <Shield className={`${size} mr-2`} />, color: 'text-green-400' },
      
      // ÏÇ¨Ïù¥Î≤ÑÌéëÌÅ¨ ÏÑ∏Í≥ÑÍ¥Ä Îä•Î†•Ïπò
      body: { icon: <Activity className={`${size} mr-2`} />, color: 'text-red-400' },
      neural: { icon: <Cpu className={`${size} mr-2`} />, color: 'text-blue-400' },
      reflex: { icon: <Target className={`${size} mr-2`} />, color: 'text-yellow-400' },
      technical: { icon: <Wrench className={`${size} mr-2`} />, color: 'text-green-400' },
      cool: { icon: <ThermometerSun className={`${size} mr-2`} />, color: 'text-purple-400' },
      reputation: { icon: <Star className={`${size} mr-2`} />, color: 'text-orange-400' },
    };
    
    return iconMap[statKey] || { icon: <Shield className={`${size} mr-2`} />, color: 'text-gray-400' };
  };

  // ÏïÑÏù¥ÌÖú ÏïÑÏù¥ÏΩò Îß§Ìïë Ìï®Ïàò
  const getItemIcon = (itemName: string) => {
    const name = itemName.toLowerCase();
    if (name.includes('Í≤Ä') || name.includes('sword') || name.includes('blade')) return '‚öîÔ∏è';
    if (name.includes('Î∞©Ìå®') || name.includes('shield')) return 'üõ°Ô∏è';
    if (name.includes('Î¨ºÏïΩ') || name.includes('potion')) return 'üß™';
    if (name.includes('Í∞ëÏò∑') || name.includes('armor')) return 'üëï';
    if (name.includes('Î∞òÏßÄ') || name.includes('ring')) return 'üíç';
    if (name.includes('Î™©Í±∏Ïù¥') || name.includes('necklace')) return 'üìø';
    if (name.includes('Î∂ÄÏ∏†') || name.includes('boots')) return 'üë¢';
    if (name.includes('Ìó¨Î©ß') || name.includes('helmet')) return '‚õëÔ∏è';
    if (name.includes('ÎßàÎ≤ï') || name.includes('magic')) return '‚ú®';
    if (name.includes('Ïó¥Ïá†') || name.includes('key')) return 'üóùÔ∏è';
    if (name.includes('Î≥¥ÏÑù') || name.includes('gem')) return 'üíé';
    if (name.includes('ÎëêÎ£®ÎßàÎ¶¨') || name.includes('scroll')) return 'üìú';
    if (name.includes('ÌôîÏÇ¥') || name.includes('arrow')) return 'üèπ';
    if (name.includes('Ìôú') || name.includes('bow')) return 'üèπ';
    if (name.includes('Ï¥ù') || name.includes('gun') || name.includes('rifle')) return 'üî´';
    if (name.includes('Îç∞Ïù¥ÌÑ∞') || name.includes('data')) return 'üíæ';
    if (name.includes('Ïπ©') || name.includes('chip')) return 'üîå';
    if (name.includes('Ïû•ÎπÑ') || name.includes('equipment')) return '‚öôÔ∏è';
    return 'üì¶';
  };

  // ÏïÑÏù¥ÌÖú ÌÉÄÏûÖÏùÑ ÌïúÍ∏ÄÎ°ú Î≥ÄÌôò
  const getItemType = (item: any) => {
    const type = item.type?.toLowerCase() || '';
    const name = item.name?.toLowerCase() || '';
    
    if (type.includes('weapon') || name.includes('Í≤Ä') || name.includes('Ï¥ù')) return 'Î¨¥Í∏∞';
    if (type.includes('armor') || name.includes('Í∞ëÏò∑') || name.includes('Î∞©Ïñ¥Íµ¨')) return 'Î∞©Ïñ¥Íµ¨';
    if (type.includes('accessory') || name.includes('Î∞òÏßÄ') || name.includes('Î™©Í±∏Ïù¥')) return 'Ïû•Ïã†Íµ¨';
    if (type.includes('consumable') || name.includes('Î¨ºÏïΩ') || name.includes('Ìè¨ÏÖò')) return 'ÏÜåÎ™®Ìíà';
    if (type.includes('equipment') || name.includes('Ïû•ÎπÑ')) return 'Ïû•ÎπÑ';
    if (type.includes('data') || name.includes('Îç∞Ïù¥ÌÑ∞')) return 'Îç∞Ïù¥ÌÑ∞';
    if (type.includes('chip') || name.includes('Ïπ©')) return 'ÏÇ¨Ïù¥Î≤Ñ Ïπ©';
    if (type.includes('key') || name.includes('Ïó¥Ïá†')) return 'ÌäπÏàò ÏïÑÏù¥ÌÖú';
    return 'ÏùºÎ∞ò ÏïÑÏù¥ÌÖú';
  };

  // Ïä§ÌÇ¨ ÌÉÄÏûÖÏùÑ ÌïúÍ∏ÄÎ°ú Î≥ÄÌôò
  const getSkillType = (skill: any) => {
    const name = skill.name?.toLowerCase() || skill.toLowerCase();
    
    if (name.includes('Ìï¥ÌÇπ') || name.includes('hack')) return 'Ìï¥ÌÇπ Ïä§ÌÇ¨';
    if (name.includes('Îç∞Ïù¥ÌÑ∞') || name.includes('data')) return 'Îç∞Ïù¥ÌÑ∞ Ïä§ÌÇ¨';
    if (name.includes('ai') || name.includes('ÌÜµÏ†ú') || name.includes('Ï†úÏñ¥')) return 'AI Ï†úÏñ¥';
    if (name.includes('Í≥µÍ≤©') || name.includes('attack') || name.includes('Ï†ÑÌà¨')) return 'Ï†ÑÌà¨ Ïä§ÌÇ¨';
    if (name.includes('Î∞©Ïñ¥') || name.includes('defense') || name.includes('Î≥¥Ìò∏')) return 'Î∞©Ïñ¥ Ïä§ÌÇ¨';
    if (name.includes('ÌöåÎ≥µ') || name.includes('heal') || name.includes('ÏπòÎ£å')) return 'ÌöåÎ≥µ Ïä§ÌÇ¨';
    if (name.includes('ÎßàÎ≤ï') || name.includes('magic') || name.includes('spell')) return 'ÎßàÎ≤ï Ïä§ÌÇ¨';
    if (name.includes('Ï†ïÏ∞∞') || name.includes('scout') || name.includes('ÌÉêÏßÄ')) return 'Ï†ïÏ∞∞ Ïä§ÌÇ¨';
    return 'ÌäπÏàò Ïä§ÌÇ¨';
  };

  // Ïä§ÌÇ¨ ÏïÑÏù¥ÏΩò Îß§Ìïë
  const getSkillIcon = (skill: any) => {
    const name = skill.name?.toLowerCase() || skill.toLowerCase();
    
    if (name.includes('Ìï¥ÌÇπ') || name.includes('hack')) return 'üíª';
    if (name.includes('Îç∞Ïù¥ÌÑ∞') || name.includes('data')) return 'üíæ';
    if (name.includes('ai') || name.includes('ÌÜµÏ†ú') || name.includes('Ï†úÏñ¥')) return 'ü§ñ';
    if (name.includes('Í≥µÍ≤©') || name.includes('attack') || name.includes('Ï†ÑÌà¨')) return '‚öîÔ∏è';
    if (name.includes('Î∞©Ïñ¥') || name.includes('defense') || name.includes('Î≥¥Ìò∏')) return 'üõ°Ô∏è';
    if (name.includes('ÌöåÎ≥µ') || name.includes('heal') || name.includes('ÏπòÎ£å')) return 'üíö';
    if (name.includes('ÎßàÎ≤ï') || name.includes('magic') || name.includes('spell')) return '‚ú®';
    if (name.includes('Ï†ïÏ∞∞') || name.includes('scout') || name.includes('ÌÉêÏßÄ')) return 'üîç';
    return '‚≠ê';
  };

  // Ï∫êÎ¶≠ÌÑ∞Ïùò Îä•Î†•Ïπò Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
  const getStatValue = (statKey: string): number => {
    const characterStats: { [key: string]: any } = character;
    
    if (currentWorld.id === 'cyberpunk_2187') {
      const mappingTable: { [key: string]: string } = {
        'body': 'health',
        'neural': 'mana', 
        'reflex': 'dexterity',
        'technical': 'intelligence',
        'cool': 'constitution',
        'reputation': 'strength'
      };
      
      const mappedKey = mappingTable[statKey] || statKey;
      return characterStats[mappedKey] || 0;
    }
    
    if (currentWorld.id === 'dark_finance') {
      const mappingTable: { [key: string]: string } = {
        'capital': 'gold', // ÏûêÎ≥∏ -> Í≥®ÎìúÎ°ú Îß§Ìïë
        'information': 'intelligence', // Ï†ïÎ≥¥Î†• -> ÏßÄÎä•ÏúºÎ°ú Îß§Ìïë
        'network': 'dexterity', // Ïù∏Îß• -> ÎØºÏ≤©ÏúºÎ°ú Îß§Ìïë
        'technical': 'constitution', // Í∏∞Ïà†Î†• -> Ï≤¥ÏßàÏúºÎ°ú Îß§Ìïë
        'psychology': 'strength', // Ïã¨Î¶¨Ï†Ñ -> ÌûòÏúºÎ°ú Îß§Ìïë
        'reputation': 'experience' // Î™ÖÏÑ±ÎèÑ -> Í≤ΩÌóòÏπòÎ°ú Îß§Ìïë
      };
      
      const mappedKey = mappingTable[statKey] || statKey;
      return characterStats[mappedKey] || 0;
    }
    
    return characterStats[statKey] || 0;
  };

  // Ï£ºÏöî Îä•Î†•ÏπòÏù∏ÏßÄ ÌåêÎã®
  const isPrimaryResource = (statKey: string): boolean => {
    return ['health', 'mana', 'body', 'neural'].includes(statKey);
  };

  // Îä•Î†•Ïπò Î∂ÑÎ¶¨
  const primaryStats = Object.keys(statNames).filter(isPrimaryResource);
  const secondaryStats = Object.keys(statNames).filter(key => !isPrimaryResource(key));

  // Î†àÎ≤® ÏßÑÌñâÎèÑ Í≥ÑÏÇ∞
  const expToNextLevel = character.level * 100;
  const expProgress = (character.experience / expToNextLevel) * 100;

  return (
    <div className="h-full flex flex-col bg-gradient-to-br from-slate-800/95 to-slate-900/95 backdrop-blur-sm border border-purple-500/30 rounded-2xl overflow-hidden">
      
      {/* Ïª¥Ìå©Ìä∏Ìïú Ï∫êÎ¶≠ÌÑ∞ Ìó§Îçî */}
      <div className="relative bg-gradient-to-r from-purple-600/20 via-blue-600/20 to-purple-600/20 p-3 border-b border-purple-500/30">
        <div className="flex items-center space-x-3">
          <div className="relative">
            <CharacterAvatarWithTooltip 
              character={character} 
              size="medium" 
              showBorder={true}
              showLevel={true}
              className="ring-2 ring-purple-500/50"
            />
          </div>
          
          <div className="flex-1 min-w-0">
            <h2 className="text-lg font-bold text-white mb-1 truncate">{character.name}</h2>
            <div className="flex items-center space-x-2 text-xs">
              <span className="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-2 py-1 rounded-full font-medium">
                {character.job}
              </span>
              <span className="bg-gradient-to-r from-yellow-600 to-orange-600 text-white px-2 py-1 rounded-full font-medium">
                Lv.{character.level}
              </span>
            </div>
          </div>
          
          {/* Í≤ΩÌóòÏπò Î∞î - Ïò§Î•∏Ï™ΩÏóê ÏÑ∏Î°úÎ°ú */}
          <div className="flex flex-col items-center">
            <span className="text-xs text-purple-300 mb-1">EXP</span>
            <div className="w-4 h-16 bg-slate-700/80 rounded-full overflow-hidden rotate-180">
              <div 
                className="bg-gradient-to-t from-purple-500 to-blue-500 w-full transition-all duration-1000 ease-out"
                style={{ height: `${Math.max(2, expProgress)}%` }}
              ></div>
            </div>
            <span className="text-xs text-white font-bold mt-1">{Math.round(expProgress)}%</span>
          </div>
        </div>
      </div>

      {/* Í∞ÑÏÜåÌôîÎêú ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */}
      <div className="flex bg-slate-800/50 border-b border-slate-600/50">
        {[
          { id: 'overview', label: 'Ï†ÑÏ≤¥', icon: Activity },
          { id: 'stats', label: 'Îä•Î†•Ïπò', icon: TrendingUp },
          { id: 'inventory', label: 'ÏÜåÏßÄÌíà', icon: Package },
          { id: 'advanced', label: 'ÏãúÏä§ÌÖú', icon: Brain }
        ].map((tab) => {
          const Icon = tab.icon;
          return (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as any)}
              className={`flex-1 flex items-center justify-center px-2 py-2 transition-all duration-200 ${
                activeTab === tab.id
                  ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg'
                  : 'text-gray-300 hover:text-white hover:bg-slate-600/50'
              }`}
            >
              <Icon className="w-4 h-4 mr-1" />
              <span className="text-xs font-medium">{tab.label}</span>
            </button>
          );
        })}
      </div>

      {/* Ïª¥Ìå©Ìä∏Ìïú ÌÉ≠ Ïª®ÌÖêÏ∏† */}
      <div className="flex-1 overflow-y-auto custom-scrollbar p-3">
        
        {/* Ï†ÑÏ≤¥ Í∞úÏöî ÌÉ≠ - Ï¢åÏö∞ Í≥µÍ∞Ñ ÏµúÎåÄ ÌôúÏö© */}
        {activeTab === 'overview' && (
          <div className="space-y-3">
            {/* Ï£ºÏöî Î¶¨ÏÜåÏä§ - Í∞ÄÎ°ú 2Ïó¥ */}
            <div className="grid grid-cols-2 gap-3">
              {primaryStats.map((statKey) => {
                const currentValue = getStatValue(statKey);
                let maxValue = currentValue;
                
                if (currentWorld.id === 'cyberpunk_2187') {
                  if (statKey === 'body') maxValue = character.maxHealth || currentValue;
                  else if (statKey === 'neural') maxValue = character.maxMana || currentValue;
                } else {
                  const maxKey = `max${statKey.charAt(0).toUpperCase() + statKey.slice(1)}`;
                  maxValue = (character as any)[maxKey] || currentValue;
                }
                
                const percentage = maxValue > 0 ? (currentValue / maxValue) * 100 : 0;
                const statInfo = getStatIcon(statKey, 'w-5 h-5');
                
                const getBarColor = (key: string) => {
                  if (['health', 'body'].includes(key)) return 'from-red-500 to-red-400';
                  if (['mana', 'neural'].includes(key)) return 'from-blue-500 to-blue-400';
                  return 'from-green-500 to-green-400';
                };

                return (
                  <div key={statKey} className="bg-slate-700/80 rounded-lg p-3 border border-slate-600/50 hover:bg-slate-600/80 transition-colors">
                    <div className="flex items-center justify-between mb-2">
                      <div className={`flex items-center ${statInfo.color}`}>
                        {statInfo.icon}
                        <span className="font-bold text-sm">{statNames[statKey]}</span>
                      </div>
                      <span className="text-lg font-bold text-white">
                        {currentValue}<span className="text-gray-400 text-xs">/{maxValue}</span>
                      </span>
                    </div>
                    
                    <div className="w-full bg-slate-800 rounded-full h-2 overflow-hidden">
                      <div 
                        className={`bg-gradient-to-r ${getBarColor(statKey)} h-2 rounded-full transition-all duration-500 relative`}
                        style={{ width: `${Math.max(2, percentage)}%` }}
                      >
                        {percentage < 30 && (
                          <div className="absolute inset-0 animate-pulse bg-red-500/30 rounded-full"></div>
                        )}
                      </div>
                    </div>
                    
                    <div className="mt-1 text-right">
                      <span className={`text-xs font-medium ${
                        percentage > 70 ? 'text-green-400' : 
                        percentage > 30 ? 'text-yellow-400' : 'text-red-400'
                      }`}>
                        {Math.round(percentage)}%
                      </span>
                    </div>
                  </div>
                );
              })}
            </div>

            {/* Í≥®ÎìúÏôÄ Ï£ºÏöî ÏïÑÏù¥ÌÖú - Í∞ÄÎ°ú Î∞∞Ïπò */}
            <div className="grid grid-cols-3 gap-3">
              {/* Í≥®Îìú */}
              <div className="bg-gradient-to-r from-yellow-600/20 to-amber-600/20 border border-yellow-500/30 rounded-lg p-3">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="flex items-center text-yellow-400 mb-1">
                      <Coins className="w-4 h-4 mr-1" />
                      <span className="text-xs">ÏûêÏÇ∞</span>
                    </div>
                    <div className="text-lg font-bold text-yellow-400">{character.gold.toLocaleString()}</div>
                  </div>
                </div>
              </div>

              {/* Ïä§ÌÇ¨ ÎØ∏Î¶¨Î≥¥Í∏∞ */}
              <div className="bg-slate-700/80 border border-purple-500/30 rounded-lg p-3">
                <div className="flex items-center text-purple-400 mb-2">
                  <Star className="w-4 h-4 mr-1" />
                  <span className="text-xs font-bold">Ïä§ÌÇ¨</span>
                </div>
                <div className="text-lg font-bold text-white">{character.skills?.length || 0}</div>
                <div className="text-xs text-gray-400">Î≥¥Ïú† Ï§ë</div>
              </div>

              {/* ÏïÑÏù¥ÌÖú ÎØ∏Î¶¨Î≥¥Í∏∞ */}
              <div className="bg-slate-700/80 border border-green-500/30 rounded-lg p-3">
                <div className="flex items-center text-green-400 mb-2">
                  <Package className="w-4 h-4 mr-1" />
                  <span className="text-xs font-bold">ÏïÑÏù¥ÌÖú</span>
                </div>
                <div className="text-lg font-bold text-white">{character.inventory?.length || 0}</div>
                <div className="text-xs text-gray-400">Î≥¥Ïú† Ï§ë</div>
              </div>
            </div>

            {/* Î≥¥Ï°∞ Îä•Î†•Ïπò - Í∞ÄÎ°ú 4Ïó¥ */}
            <div className="bg-slate-700/50 rounded-lg p-3 border border-slate-600/50">
              <h4 className="text-sm font-bold text-white mb-2 flex items-center">
                <TrendingUp className="w-4 h-4 mr-2 text-purple-400" />
                Îä•Î†•Ïπò
              </h4>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                {secondaryStats.map((statKey) => {
                  const statValue = getStatValue(statKey);
                  const statInfo = getStatIcon(statKey, 'w-4 h-4');

                  return (
                    <div key={statKey} className="bg-slate-600/50 rounded p-2 text-center">
                      <div className={`flex items-center justify-center ${statInfo.color} mb-1`}>
                        {statInfo.icon}
                      </div>
                      <div className="text-lg font-bold text-white">{statValue}</div>
                      <div className="text-xs text-gray-400">{statNames[statKey]}</div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        )}

        {/* Îä•Î†•Ïπò ÏÉÅÏÑ∏ ÌÉ≠ */}
        {activeTab === 'stats' && (
          <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
            {Object.keys(statNames).map((statKey) => {
              const statValue = getStatValue(statKey);
              const statInfo = getStatIcon(statKey);

              return (
                <div key={statKey} className="bg-slate-700/80 rounded-lg p-3 border border-slate-600/50 hover:bg-slate-600/80 transition-colors">
                  <div className={`flex items-center ${statInfo.color} mb-2`}>
                    {statInfo.icon}
                    <span className="font-bold text-sm">{statNames[statKey]}</span>
                  </div>
                  <div className="text-right">
                    <div className="text-2xl font-bold text-white">{statValue}</div>
                  </div>
                </div>
              );
            })}
          </div>
        )}

                 {/* Ïù∏Î≤§ÌÜ†Î¶¨ ÌÉ≠ - Í∞úÏÑ†Îêú ÏïÑÏù¥ÌÖúÍ≥º Ïä§ÌÇ¨ ÌëúÏãú */}
         {activeTab === 'inventory' && (
           <div className="space-y-4">
             {/* Ïä§ÌÇ¨ ÏÑπÏÖò */}
             <div className="bg-slate-700/50 rounded-lg p-3 border border-purple-500/30">
               <h4 className="font-bold text-purple-300 mb-3 flex items-center">
                 <Star className="w-4 h-4 mr-2" />
                 Î≥¥Ïú† Ïä§ÌÇ¨ ({character.skills?.length || 0}Í∞ú)
               </h4>
               <div className="grid grid-cols-1 gap-2">
                 {character.skills && character.skills.length > 0 ? (
                   character.skills.map((skill, index) => (
                     <div 
                       key={skill.id || index} 
                       className="bg-slate-600/50 rounded-lg p-3 border border-purple-500/20 hover:bg-slate-500/50 transition-colors group"
                       title={skill.name || skill}
                     >
                       <div className="flex items-center justify-between">
                         <div className="flex items-center space-x-3 flex-1 min-w-0">
                           <div className="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center border border-purple-500/30">
                             <span className="text-lg">{getSkillIcon(skill)}</span>
                           </div>
                           <div className="flex-1 min-w-0">
                             <div className="font-medium text-purple-300 text-sm group-hover:text-purple-200 transition-colors">
                               {skill.name || skill}
                             </div>
                             <div className="text-xs text-purple-400 font-medium">
                               {getSkillType(skill)}
                             </div>
                             {skill.description && (
                               <div className="text-xs text-gray-400 mt-1 line-clamp-2">
                                 {skill.description}
                               </div>
                             )}
                           </div>
                         </div>
                         {typeof skill === 'object' && skill.manaCost > 0 && (
                           <div className="bg-blue-500/20 border border-blue-500/30 rounded-lg px-2 py-1">
                             <div className="text-blue-400 font-bold text-sm">{skill.manaCost}</div>
                             <div className="text-blue-300 text-xs">MP</div>
                           </div>
                         )}
                       </div>
                     </div>
                   ))
                 ) : (
                   <div className="text-center text-gray-400 py-6">
                     <div className="w-16 h-16 bg-purple-500/10 rounded-full flex items-center justify-center mx-auto mb-3 border border-purple-500/20">
                       <Star className="w-8 h-8 opacity-50 text-purple-400" />
                     </div>
                     <div className="text-sm font-medium">Î≥¥Ïú†Ìïú Ïä§ÌÇ¨Ïù¥ ÏóÜÏäµÎãàÎã§</div>
                     <div className="text-xs text-gray-500">Ïä§ÌÇ¨ÏùÑ ÏäµÎìùÌïòÏó¨ Îä•Î†•ÏùÑ Í∞ïÌôîÌïòÏÑ∏Ïöî</div>
                   </div>
                 )}
               </div>
             </div>

             {/* ÏïÑÏù¥ÌÖú ÏÑπÏÖò - Í∞úÏÑ†Îêú ÏïÑÏù¥ÌÖú Ï†ïÎ≥¥ */}
             <div className="bg-slate-700/50 rounded-lg p-3 border border-green-500/30">
               <h4 className="font-bold text-green-300 mb-3 flex items-center">
                 <Package className="w-4 h-4 mr-2" />
                 Î≥¥Ïú† ÏïÑÏù¥ÌÖú ({character.inventory?.length || 0}Í∞ú)
               </h4>
               <div className="grid grid-cols-1 gap-2">
                 {character.inventory && character.inventory.length > 0 ? (
                   character.inventory.map((item, index) => (
                     <div 
                       key={item.id || index} 
                       className="bg-slate-600/50 rounded-lg p-3 border border-green-500/20 hover:bg-slate-500/50 transition-colors group"
                       title={item.name}
                     >
                       <div className="flex items-center space-x-3">
                         <div className="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center border border-green-500/30">
                           <span className="text-lg">{getItemIcon(item.name)}</span>
                         </div>
                         <div className="flex-1 min-w-0">
                           <div className="font-medium text-green-300 text-sm group-hover:text-green-200 transition-colors">
                             {item.name}
                           </div>
                           <div className="flex items-center space-x-2 mt-1">
                             <span className="text-xs text-green-400 font-medium bg-green-500/10 px-2 py-1 rounded border border-green-500/20">
                               {getItemType(item)}
                             </span>
                             {item.rarity && (
                               <span className={`text-xs font-medium px-2 py-1 rounded ${
                                 item.rarity === 'legendary' ? 'text-orange-400 bg-orange-500/10 border border-orange-500/20' :
                                 item.rarity === 'epic' ? 'text-purple-400 bg-purple-500/10 border border-purple-500/20' :
                                 item.rarity === 'rare' ? 'text-blue-400 bg-blue-500/10 border border-blue-500/20' :
                                 'text-gray-400 bg-gray-500/10 border border-gray-500/20'
                               }`}>
                                 {item.rarity === 'legendary' ? 'Ï†ÑÏÑ§' :
                                  item.rarity === 'epic' ? 'ÏòÅÏõÖ' :
                                  item.rarity === 'rare' ? 'Ìù¨Í∑Ä' : 'ÏùºÎ∞ò'}
                               </span>
                             )}
                           </div>
                           {item.description && (
                             <div className="text-xs text-gray-400 mt-2 leading-relaxed">
                               {item.description}
                             </div>
                           )}
                           {item.stats && (
                             <div className="flex flex-wrap gap-1 mt-2">
                               {Object.entries(item.stats).map(([stat, value]) => (
                                 <span key={stat} className="text-xs text-yellow-400 bg-yellow-500/10 px-2 py-1 rounded border border-yellow-500/20">
                                   {stat} +{value}
                                 </span>
                               ))}
                             </div>
                           )}
                         </div>
                       </div>
                     </div>
                   ))
                 ) : (
                   <div className="text-center text-gray-400 py-6">
                     <div className="w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-3 border border-green-500/20">
                       <Package className="w-8 h-8 opacity-50 text-green-400" />
                     </div>
                     <div className="text-sm font-medium">Î≥¥Ïú†Ìïú ÏïÑÏù¥ÌÖúÏù¥ ÏóÜÏäµÎãàÎã§</div>
                     <div className="text-xs text-gray-500">Î™®ÌóòÏùÑ ÌÜµÌï¥ ÏïÑÏù¥ÌÖúÏùÑ ÏàòÏßëÌïòÏÑ∏Ïöî</div>
                   </div>
                 )}
               </div>
             </div>
           </div>
         )}

        {/* Í≥†Í∏â ÏãúÏä§ÌÖú ÌÉ≠ */}
        {activeTab === 'advanced' && (
          <AdvancedSystemsDashboard character={character} />
        )}
      </div>
    </div>
  );
};

export default CharacterStats;